---
const { title } = Astro.props;
---
<section class="topo-hero">
  <canvas id="topo-canvas" aria-hidden="true"></canvas>
  <div class="overlay">
    <div class="grid" aria-hidden="true"></div>
    <div class="frame" aria-hidden="true"></div>
    <div class="hud" aria-hidden="true">
      <span id="coord" class="coord mono">37.7749, -122.4194</span>
      <span class="compass n mono">N</span>
      <span class="compass e mono">E</span>
      <span class="compass s mono">S</span>
      <span class="compass w mono">W</span>
    </div>
  </div>
  <nav class="hero-nav">
    <a href="/" class="brand">{title}</a>
    <ul>
      <li><a href="/work">Work</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/experiments">Experiments</a></li>
      <li><a href="/about">About</a></li>
    </ul>
  </nav>
  <script type="module" src="/topo.js"></script>
  <script type="module">
    const hero = document.querySelector('.topo-hero');
    const nav = hero.querySelector('.hero-nav');
    const navHeight = nav.offsetHeight;
    hero.style.setProperty('--nav-height', `${navHeight}px`);
    function onScroll() {
      if (window.scrollY > hero.offsetHeight - navHeight) {
        hero.classList.add('collapsed');
        nav.classList.add('sticky');
      } else {
        hero.classList.remove('collapsed');
        nav.classList.remove('sticky');
      }
    }
    window.addEventListener('scroll', onScroll);
  </script>
  <style>
    .topo-hero {
      position: relative;
      width: calc(100% - var(--space-4));
      /* Fill the viewport while preserving space for compass labels */
      height: calc(100vh - var(--space-4));
      height: calc(100svh - var(--space-4));
      margin: var(--space-2);
      --frame-color: var(--color-text);
      --grid-major: color-mix(in srgb, var(--color-accent) 30%, transparent);
      --grid-minor: color-mix(in srgb, var(--color-accent) 15%, transparent);
      --contour-color: #000;
      --nav-height: 56px;
      background: var(--color-bg);
    }
    .topo-hero canvas {
      width: 100%;
      height: 100%;
      display: block;
      background: var(--color-bg);
    }
    .topo-hero .overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }
    .topo-hero .grid {
      position: absolute;
      inset: 0;
      background-image:
        repeating-linear-gradient(var(--grid-minor) 0 1px, transparent 1px 16px),
        repeating-linear-gradient(90deg, var(--grid-minor) 0 1px, transparent 1px 16px),
        repeating-linear-gradient(var(--grid-major) 0 1px, transparent 1px 128px),
        repeating-linear-gradient(90deg, var(--grid-major) 0 1px, transparent 1px 128px);
    }
    .topo-hero .frame {
      position: absolute;
      inset: 0;
      border: 1px solid var(--frame-color);
    }
    .topo-hero .hud .coord {
      position: absolute;
      top: 4px;
      left: 4px;
      font-size: var(--text-12);
      color: color-mix(in srgb, var(--frame-color) 60%, transparent);
    }
    .topo-hero .hud .compass {
      position: absolute;
      font-size: var(--text-12);
      color: color-mix(in srgb, var(--frame-color) 60%, transparent);
    }
    .topo-hero .hud .n { top: -16px; left: 50%; transform: translateX(-50%); }
    .topo-hero .hud .s { bottom: -16px; left: 50%; transform: translateX(-50%); }
    .topo-hero .hud .e { right: -16px; top: 50%; transform: translateY(-50%); }
    .topo-hero .hud .w { left: -16px; top: 50%; transform: translateY(-50%); }
    .hero-nav {
      position: absolute;
      bottom: var(--space-2);
      left: var(--space-2);
      display: flex;
      align-items: center;
      gap: var(--space-2);
      color: var(--frame-color);

      background: #fff;
      padding: var(--space-1) var(--space-2);

    }
    .hero-nav ul {
      display: flex;
      gap: var(--space-2);
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .hero-nav.sticky {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;

      background: #fff;

      padding: var(--space-2);
      justify-content: space-between;
      z-index: 1000;
    }
    .topo-hero.collapsed {
      height: var(--nav-height);
      max-height: var(--nav-height);
      aspect-ratio: auto;
    }

    @media (max-width: 600px) {
      .hero-nav {
        flex-direction: column;
        align-items: flex-start;
      }
      .hero-nav ul {
        flex-direction: column;
        width: 100%;
      }
    }
  </style>
</section>
